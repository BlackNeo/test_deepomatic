/*!
 * deepomatic 0.1.0
 * build 2016-09-27T20:10:41
 * https://github.com/Deepomatic/deepomaticsearch-client-js
 * Copyright 2015 Deepomatic SAS; Licensed MIT
 */

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.deepomaticsearch=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(a){}}function h(){var a;try{a=c.storage.debug}catch(a){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":2}],2:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:3}],3:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b.long?f(a):e(a)}},{}],4:[function(b,c,d){(function(d,e){(function(){"use strict";function f(a){return"function"==typeof a||"object"==typeof a&&null!==a}function g(a){return"function"==typeof a}function h(a){X=a}function i(a){_=a}function j(){return function(){d.nextTick(o)}}function k(){return function(){W(o)}}function l(){var a=0,b=new ca(o),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function m(){var a=new MessageChannel;return a.port1.onmessage=o,function(){a.port2.postMessage(0)}}function n(){return function(){setTimeout(o,1)}}function o(){for(var a=0;a<$;a+=2){var b=fa[a],c=fa[a+1];b(c),fa[a]=void 0,fa[a+1]=void 0}$=0}function p(){try{var a=b,c=a("vertx");return W=c.runOnLoop||c.runOnContext,k()}catch(a){return n()}}function q(a,b){var c=this,d=new this.constructor(s);void 0===d[ia]&&L(d);var e=c._state;if(e){var f=arguments[e-1];_(function(){I(e,d,f,c._result)})}else E(c,d,a,b);return d}function r(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(s);return A(c,a),c}function s(){}function t(){return new TypeError("You cannot resolve a promise with itself")}function u(){return new TypeError("A promises callback cannot return that same promise.")}function v(a){try{return a.then}catch(a){return ma.error=a,ma}}function w(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function x(a,b,c){_(function(a){var d=!1,e=w(c,b,function(c){d||(d=!0,b!==c?A(a,c):C(a,c))},function(b){d||(d=!0,D(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,D(a,e))},a)}function y(a,b){b._state===ka?C(a,b._result):b._state===la?D(a,b._result):E(b,void 0,function(b){A(a,b)},function(b){D(a,b)})}function z(a,b,c){b.constructor===a.constructor&&c===ga&&constructor.resolve===ha?y(a,b):c===ma?D(a,ma.error):void 0===c?C(a,b):g(c)?x(a,b,c):C(a,b)}function A(a,b){a===b?D(a,t()):f(b)?z(a,b,v(b)):C(a,b)}function B(a){a._onerror&&a._onerror(a._result),F(a)}function C(a,b){a._state===ja&&(a._result=b,a._state=ka,0!==a._subscribers.length&&_(F,a))}function D(a,b){a._state===ja&&(a._state=la,a._result=b,_(B,a))}function E(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+ka]=c,e[f+la]=d,0===f&&a._state&&_(F,a)}function F(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?I(c,d,e,f):e(f);a._subscribers.length=0}}function G(){this.error=null}function H(a,b){try{return a(b)}catch(a){return na.error=a,na}}function I(a,b,c,d){var e,f,h,i,j=g(c);if(j){if(e=H(c,d),e===na?(i=!0,f=e.error,e=null):h=!0,b===e)return void D(b,u())}else e=d,h=!0;b._state!==ja||(j&&h?A(b,e):i?D(b,f):a===ka?C(b,e):a===la&&D(b,e))}function J(a,b){try{b(function(b){A(a,b)},function(b){D(a,b)})}catch(b){D(a,b)}}function K(){return oa++}function L(a){a[ia]=oa++,a._state=void 0,a._result=void 0,a._subscribers=[]}function M(a){return new ta(this,a).promise}function N(a){var b=this;return new b(Z(a)?function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}:function(a,b){b(new TypeError("You must pass an array to race."))})}function O(a){var b=this,c=new b(s);return D(c,a),c}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Q(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function R(a){this[ia]=K(),this._result=this._state=void 0,this._subscribers=[],s!==a&&("function"!=typeof a&&P(),this instanceof R?J(this,a):Q())}function S(a,b){this._instanceConstructor=a,this.promise=new a(s),this.promise[ia]||L(this.promise),Z(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&C(this.promise,this._result))):D(this.promise,T())}function T(){return new Error("Array Methods must be provided an Array")}function U(){var a;if("undefined"!=typeof e)a=e;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(a){throw new Error("polyfill failed because global object is unavailable in this environment")}var b=a.Promise;b&&"[object Promise]"===Object.prototype.toString.call(b.resolve())&&!b.cast||(a.Promise=sa)}var V;V=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var W,X,Y,Z=V,$=0,_=function(a,b){fa[$]=a,fa[$+1]=b,$+=2,2===$&&(X?X(o):Y())},aa="undefined"!=typeof window?window:void 0,ba=aa||{},ca=ba.MutationObserver||ba.WebKitMutationObserver,da="undefined"==typeof self&&"undefined"!=typeof d&&"[object process]"==={}.toString.call(d),ea="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,fa=new Array(1e3);Y=da?j():ca?l():ea?m():void 0===aa&&"function"==typeof b?p():n();var ga=q,ha=r,ia=Math.random().toString(36).substring(16),ja=void 0,ka=1,la=2,ma=new G,na=new G,oa=0,pa=M,qa=N,ra=O,sa=R;R.all=pa,R.race=qa,R.resolve=ha,R.reject=ra,R._setScheduler=h,R._setAsap=i,R._asap=_,R.prototype={constructor:R,then:ga,catch:function(a){return this.then(null,a)}};var ta=S;S.prototype._enumerate=function(){for(var a=this.length,b=this._input,c=0;this._state===ja&&c<a;c++)this._eachEntry(b[c],c)},S.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===ha){var e=v(a);if(e===ga&&a._state!==ja)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===sa){var f=new c(s);z(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){b(a)}),b)}else this._willSettleAt(d(a),b)},S.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ja&&(this._remaining--,a===la?D(d,c):this._result[b]=c),0===this._remaining&&C(d,this._result)},S.prototype._willSettleAt=function(a,b){var c=this;E(a,void 0,function(a){c._settledAt(ka,b,a)},function(a){c._settledAt(la,b,a)})};var ua=U,va={Promise:sa,polyfill:ua};"function"==typeof a&&a.amd?a(function(){return va}):"undefined"!=typeof c&&c.exports?c.exports=va:"undefined"!=typeof this&&(this.ES6Promise=va),ua()}).call(this)}).call(this,b("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:5}],5:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],6:[function(a,b,c){"use strict";function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,c,f){b=b||"&",c=c||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;k<j;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(c);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),d(g,n)?e(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],7:[function(a,b,c){"use strict";function d(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var e=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,c,h){return b=b||"&",c=c||"=",null===a&&(a=void 0),"object"==typeof a?d(g(a),function(g){var h=encodeURIComponent(e(g))+c;return f(a[g])?d(a[g],function(a){return h+encodeURIComponent(e(a))}).join(b):h+encodeURIComponent(e(a[g]))}).join(b):h?encodeURIComponent(e(h))+c+encodeURIComponent(e(a)):""};var f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],8:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":6,"./encode":7}],9:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],10:[function(a,b,c){var d=a("../internal/arrayEach"),e=a("../internal/baseEach"),f=a("../internal/createForEach"),g=f(d,e);b.exports=g},{"../internal/arrayEach":12,"../internal/baseEach":16,"../internal/createForEach":24}],11:[function(a,b,c){function d(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}b.exports=d},{}],12:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}b.exports=d},{}],13:[function(a,b,c){function d(a,b){return null==b?a:e(b,f(b),a)}var e=a("./baseCopy"),f=a("../object/keys");b.exports=d},{"../object/keys":44,"./baseCopy":15}],14:[function(a,b,c){function d(a,b,c,p,q,r,s){var u;if(c&&(u=q?c(a,p,q):c(a)),void 0!==u)return u;if(!n(a))return a;var v=l(a);if(v){if(u=i(a),!b)return e(a,u)}else{var x=N.call(a),y=x==t;if(x!=w&&x!=o&&(!y||q))return L[x]?j(a,x,b):q?a:{};if(m(a))return q?a:{};if(u=k(y?{}:a),!b)return g(u,a)}r||(r=[]),s||(s=[]);for(var z=r.length;z--;)if(r[z]==a)return s[z];return r.push(a),s.push(u),(v?f:h)(a,function(e,f){u[f]=d(e,b,c,f,a,r,s)}),u}var e=a("./arrayCopy"),f=a("./arrayEach"),g=a("./baseAssign"),h=a("./baseForOwn"),i=a("./initCloneArray"),j=a("./initCloneByTag"),k=a("./initCloneObject"),l=a("../lang/isArray"),m=a("./isHostObject"),n=a("../lang/isObject"),o="[object Arguments]",p="[object Array]",q="[object Boolean]",r="[object Date]",s="[object Error]",t="[object Function]",u="[object Map]",v="[object Number]",w="[object Object]",x="[object RegExp]",y="[object Set]",z="[object String]",A="[object WeakMap]",B="[object ArrayBuffer]",C="[object Float32Array]",D="[object Float64Array]",E="[object Int8Array]",F="[object Int16Array]",G="[object Int32Array]",H="[object Uint8Array]",I="[object Uint8ClampedArray]",J="[object Uint16Array]",K="[object Uint32Array]",L={};L[o]=L[p]=L[B]=L[q]=L[r]=L[C]=L[D]=L[E]=L[F]=L[G]=L[v]=L[w]=L[x]=L[z]=L[H]=L[I]=L[J]=L[K]=!0,L[s]=L[t]=L[u]=L[y]=L[A]=!1;var M=Object.prototype,N=M.toString;b.exports=d},{"../lang/isArray":39,"../lang/isObject":42,"./arrayCopy":11,"./arrayEach":12,"./baseAssign":13,"./baseForOwn":18,"./initCloneArray":27,"./initCloneByTag":28,"./initCloneObject":29,"./isHostObject":31}],15:[function(a,b,c){function d(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}b.exports=d},{}],16:[function(a,b,c){var d=a("./baseForOwn"),e=a("./createBaseEach"),f=e(d);b.exports=f},{"./baseForOwn":18,"./createBaseEach":22}],17:[function(a,b,c){var d=a("./createBaseFor"),e=d();b.exports=e},{"./createBaseFor":23}],18:[function(a,b,c){function d(a,b){return e(a,b,f)}var e=a("./baseFor"),f=a("../object/keys");b.exports=d},{"../object/keys":44,"./baseFor":17}],19:[function(a,b,c){function d(a){return function(b){return null==b?void 0:e(b)[a]}}var e=a("./toObject");b.exports=d},{"./toObject":36}],20:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}var e=a("../utility/identity");b.exports=d},{"../utility/identity":47}],21:[function(a,b,c){(function(a){function c(a){var b=new d(a.byteLength),c=new e(b);return c.set(new e(a)),b}var d=a.ArrayBuffer,e=a.Uint8Array;b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(a,b,c){function d(a,b){return function(c,d){var h=c?e(c):0;if(!f(h))return a(c,d);for(var i=b?h:-1,j=g(c);(b?i--:++i<h)&&d(j[i],i,j)!==!1;);return c}}var e=a("./getLength"),f=a("./isLength"),g=a("./toObject");b.exports=d},{"./getLength":25,"./isLength":33,"./toObject":36}],23:[function(a,b,c){function d(a){return function(b,c,d){for(var f=e(b),g=d(b),h=g.length,i=a?h:-1;a?i--:++i<h;){var j=g[i];if(c(f[j],j,f)===!1)break}return b}}var e=a("./toObject");b.exports=d},{"./toObject":36}],24:[function(a,b,c){function d(a,b){return function(c,d,g){return"function"==typeof d&&void 0===g&&f(c)?a(c,d):b(c,e(d,g,3))}}var e=a("./bindCallback"),f=a("../lang/isArray");b.exports=d},{"../lang/isArray":39,"./bindCallback":20}],25:[function(a,b,c){var d=a("./baseProperty"),e=d("length");b.exports=e},{"./baseProperty":19}],26:[function(a,b,c){function d(a,b){var c=null==a?void 0:a[b];return e(c)?c:void 0}var e=a("../lang/isNative");b.exports=d},{"../lang/isNative":41}],27:[function(a,b,c){function d(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&f.call(a,"index")&&(c.index=a.index,c.input=a.input),c}var e=Object.prototype,f=e.hasOwnProperty;b.exports=d},{}],28:[function(a,b,c){(function(c){function d(a,b,c){var d=a.constructor;switch(b){case k:return e(a);case f:case g:return new d(+a);case l:case m:case n:case o:case p:case q:case r:case s:case t:d instanceof d&&(d=w[b]);var v=a.buffer;return new d(c?e(v):v,a.byteOffset,a.length);case h:case j:return new d(a);case i:var x=new d(a.source,u.exec(a));x.lastIndex=a.lastIndex}return x}var e=a("./bufferClone"),f="[object Boolean]",g="[object Date]",h="[object Number]",i="[object RegExp]",j="[object String]",k="[object ArrayBuffer]",l="[object Float32Array]",m="[object Float64Array]",n="[object Int8Array]",o="[object Int16Array]",p="[object Int32Array]",q="[object Uint8Array]",r="[object Uint8ClampedArray]",s="[object Uint16Array]",t="[object Uint32Array]",u=/\w*$/,v=c.Uint8Array,w={};w[l]=c.Float32Array,w[m]=c.Float64Array,w[n]=c.Int8Array,w[o]=c.Int16Array,w[p]=c.Int32Array,w[q]=v,w[r]=c.Uint8ClampedArray,w[s]=c.Uint16Array,w[t]=c.Uint32Array,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bufferClone":21}],29:[function(a,b,c){function d(a){var b=a.constructor;return"function"==typeof b&&b instanceof b||(b=Object),new b}b.exports=d},{}],30:[function(a,b,c){function d(a){return null!=a&&f(e(a))}var e=a("./getLength"),f=a("./isLength");b.exports=d},{"./getLength":25,"./isLength":33}],31:[function(a,b,c){var d=function(){try{Object({toString:0}+"")}catch(a){return function(){return!1}}return function(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}}();b.exports=d},{}],32:[function(a,b,c){function d(a,b){return a="number"==typeof a||e.test(a)?+a:-1,b=null==b?f:b,a>-1&&a%1==0&&a<b}var e=/^\d+$/,f=9007199254740991;b.exports=d},{}],33:[function(a,b,c){function d(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=e}var e=9007199254740991;b.exports=d},{}],34:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}b.exports=d},{}],35:[function(a,b,c){function d(a){for(var b=j(a),c=b.length,d=c&&a.length,k=!!d&&h(d)&&(f(a)||e(a)||i(a)),m=-1,n=[];++m<c;){var o=b[m];(k&&g(o,d)||l.call(a,o))&&n.push(o)}return n}var e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("./isIndex"),h=a("./isLength"),i=a("../lang/isString"),j=a("../object/keysIn"),k=Object.prototype,l=k.hasOwnProperty;b.exports=d},{"../lang/isArguments":38,"../lang/isArray":39,"../lang/isString":43,"../object/keysIn":45,"./isIndex":32,"./isLength":33}],36:[function(a,b,c){function d(a){if(g.unindexedChars&&f(a)){for(var b=-1,c=a.length,d=Object(a);++b<c;)d[b]=a.charAt(b);return d}return e(a)?a:Object(a)}var e=a("../lang/isObject"),f=a("../lang/isString"),g=a("../support");b.exports=d},{"../lang/isObject":42,"../lang/isString":43,"../support":46}],37:[function(a,b,c){function d(a,b,c){return"function"==typeof b?e(a,!0,f(b,c,3)):e(a,!0)}var e=a("../internal/baseClone"),f=a("../internal/bindCallback");b.exports=d},{"../internal/baseClone":14,"../internal/bindCallback":20}],38:[function(a,b,c){function d(a){return f(a)&&e(a)&&h.call(a,"callee")&&!i.call(a,"callee")}var e=a("../internal/isArrayLike"),f=a("../internal/isObjectLike"),g=Object.prototype,h=g.hasOwnProperty,i=g.propertyIsEnumerable;b.exports=d},{"../internal/isArrayLike":30,"../internal/isObjectLike":34}],39:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isLength"),f=a("../internal/isObjectLike"),g="[object Array]",h=Object.prototype,i=h.toString,j=d(Array,"isArray"),k=j||function(a){return f(a)&&e(a.length)&&i.call(a)==g};b.exports=k},{"../internal/getNative":26,"../internal/isLength":33,"../internal/isObjectLike":34}],40:[function(a,b,c){function d(a){return e(a)&&h.call(a)==f}var e=a("./isObject"),f="[object Function]",g=Object.prototype,h=g.toString;b.exports=d},{"./isObject":42}],41:[function(a,b,c){function d(a){return null!=a&&(e(a)?l.test(j.call(a)):g(a)&&(f(a)?l:h).test(a))}var e=a("./isFunction"),f=a("../internal/isHostObject"),g=a("../internal/isObjectLike"),h=/^\[object .+?Constructor\]$/,i=Object.prototype,j=Function.prototype.toString,k=i.hasOwnProperty,l=RegExp("^"+j.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=d},{"../internal/isHostObject":31,"../internal/isObjectLike":34,"./isFunction":40}],42:[function(a,b,c){function d(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=d},{}],43:[function(a,b,c){function d(a){return"string"==typeof a||e(a)&&h.call(a)==f}var e=a("../internal/isObjectLike"),f="[object String]",g=Object.prototype,h=g.toString;b.exports=d},{"../internal/isObjectLike":34}],44:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isArrayLike"),f=a("../lang/isObject"),g=a("../internal/shimKeys"),h=a("../support"),i=d(Object,"keys"),j=i?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||("function"==typeof a?h.enumPrototypes:e(a))?g(a):f(a)?i(a):[]}:g;b.exports=j},{"../internal/getNative":26,"../internal/isArrayLike":30,"../internal/shimKeys":35,"../lang/isObject":42,"../support":46}],45:[function(a,b,c){function d(a){if(null==a)return[];k(a)||(a=Object(a));var b=a.length;b=b&&j(b)&&(g(a)||f(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e=h(c)&&c.prototype||y,n=e===a,o=Array(b),p=b>0,r=m.enumErrorProps&&(a===x||a instanceof Error),s=m.enumPrototypes&&h(a);++d<b;)o[d]=d+"";for(var u in a)s&&"prototype"==u||r&&("message"==u||"name"==u)||p&&i(u,b)||"constructor"==u&&(n||!A.call(a,u))||o.push(u);if(m.nonEnumShadows&&a!==y){var D=a===z?v:a===x?q:B.call(a),E=C[D]||C[t];for(D==t&&(e=y),b=w.length;b--;){u=w[b];var F=E[u];n&&F||(F?!A.call(a,u):a[u]===e[u])||o.push(u)}}return o}var e=a("../internal/arrayEach"),f=a("../lang/isArguments"),g=a("../lang/isArray"),h=a("../lang/isFunction"),i=a("../internal/isIndex"),j=a("../internal/isLength"),k=a("../lang/isObject"),l=a("../lang/isString"),m=a("../support"),n="[object Array]",o="[object Boolean]",p="[object Date]",q="[object Error]",r="[object Function]",s="[object Number]",t="[object Object]",u="[object RegExp]",v="[object String]",w=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],x=Error.prototype,y=Object.prototype,z=String.prototype,A=y.hasOwnProperty,B=y.toString,C={};C[n]=C[p]=C[s]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},C[o]=C[v]={constructor:!0,toString:!0,valueOf:!0},C[q]=C[r]=C[u]={constructor:!0,toString:!0},C[t]={constructor:!0},e(w,function(a){for(var b in C)if(A.call(C,b)){var c=C[b];c[a]=A.call(c,a)}}),b.exports=d},{"../internal/arrayEach":12,"../internal/isIndex":32,"../internal/isLength":33,"../lang/isArguments":38,"../lang/isArray":39,"../lang/isFunction":40,"../lang/isObject":42,"../lang/isString":43,"../support":46}],46:[function(a,b,c){var d=Array.prototype,e=Error.prototype,f=Object.prototype,g=f.propertyIsEnumerable,h=d.splice,i={};!function(a){var b=function(){this.x=a},c={0:a,length:a},d=[];b.prototype={valueOf:a,y:a};for(var f in new b)d.push(f);i.enumErrorProps=g.call(e,"message")||g.call(e,"name"),i.enumPrototypes=g.call(b,"prototype"),i.nonEnumShadows=!/valueOf/.test(d),i.ownLast="x"!=d[0],i.spliceObjects=(h.call(c,0,1),!c[0]),i.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1,0),b.exports=i},{}],47:[function(a,b,c){function d(a){return a}b.exports=d},{}],48:[function(a,b,c){function d(a,b){for(var c in b)a[c]=b[c]}function e(a){return"undefined"==typeof a||null===a}function f(a,b){return e(a)?b:a}function g(a,b,c){e(c)||(a[b]=c)}var h=a("./errors"),i=function(a,b){a.prototype=Object.create(b.prototype)},j=function(){function a(a,b){this._hits=null,q.call(this,a,b)}function b(a,b){this._subtasks=null,this._objects=null,this.response=b,task_id=b.task_id,q.call(this,a,task_id)}function c(a,b,c){this.data={method:a.toUpperCase(),db:b},"POST"!=this.data.method&&(this.data.id=c.id),this.data.method in{POST:1,PUT:1}&&d(this.data,c.toRequestBody())}function e(a,b){this.client=a,this.db=b,this.clear()}function j(a){this.client=a}var k=function(a,b){var c=[];for(var d in a)b?c.push(p.fromResponse(a[d])):c.push(o.fromResponse(a[d]));return c},l=function(){this.points=[]};l.fromResponse=function(a){if(!a)return null;polygon=new l;for(var b in a){var c=a[b];polygon.addPoint(c.x,c.y)}return polygon},l.prototype={addPoint:function(a,b){this.points.push({x:a,y:b})},toRequestBody:function(){return this.points}};var m=function(a,b,c,d){this.xmax=a,this.xmin=b,this.ymax=c,this.ymin=d};m.fromResponse=function(a){return a?new m(a.xmax,a.xmin,a.ymax,a.ymin):null},m.prototype={toRequestBody:function(){return{xmax:this.xmax,xmin:this.xmin,ymax:this.ymax,ymin:this.ymin}}};var n=function(a,b,c,d,e,g){if(b||(b="URL"),b=b.toUpperCase(),!(b in{URL:1,BASE64:1}))throw new Error("Invalid image sourceType");this.source=a,this.sourceType=b,this.polygon=f(c,null),this.bbox=f(d,null),this.width=f(e,null),this.height=f(g,null)};n.fromFile=function(a,b,c,d,e,f){var g=new FileReader;g.onload=function(a){var h=g.result,i=h.replace(/^data:image\/(.*);base64,/,"");b(new n(i,"BASE64",c,d,e,f))},g.readAsDataURL(a)},n.fromResponse=function(a){polygon=l.fromResponse(a.polygon),bbox=m.fromResponse(a.bbox);var b="",c="BASE64";return"url"in a?(b=a.url,c="URL"):"base64"in a&&(b=a.base64,c="BASE64"),new n(b,c,polygon,bbox,a.width,a.height)},n.prototype={toRequestBody:function(){body={};if("URL"==this.sourceType)body.url=this.source;else{if("BASE64"!=this.sourceType)throw new Error("Invalid image sourceType");body.base64=this.source}return this.polygon&&(body.polygon=this.polygon.toRequestBody()),this.bbox&&(body.bbox=this.bbox.toRequestBody()),body}};var o=function(a,b,c,d){this.imgs=a,this.data=b,this.id=c,this.date_updated};o.fromResponse=function(a){var b=[];for(var c in a.imgs)b.push(n.fromResponse(a.imgs[c]));return new o(b,a.data,a.id,a.date_updated)},o.prototype={toRequestBody:function(){imgsArray=[];for(var a in this.imgs)imgsArray.push(this.imgs[a].toRequestBody());return{imgs:imgsArray,data:this.data}}};var p=function(a,b,c,e,f,g){var h=o.fromResponse(a);d(this,h),this.score=b,this.matched_img_index=c,this.is_perfect_match=e,this.projected_query_corners=f,this.projected_result_corners=g};i(p,o),p.fromResponse=function(a){return new p(a,a.score,a.matched_img_index,f(a.is_perfect_match,null),f(a.projected_query_corners,null),f(a.projected_result_corners,null))};var q=function(a,b){this.client=a,this.id=b,this.data=null,this.status=null,this.error=null,this.date_created=null,this.date_updated=null,this.subtasks_status=null};q.prototype={fromResponse:function(a){this.data=a.data,this.status=a.status,this.error=a.error,this.date_created=a.date_created,this.date_updated=a.date_updated,this.subtasks_status=a.subtasks},refresh:function(a){var b=this;this.client._jsonRequest({method:"GET",url:"/tasks/"+b.id}).then(function(c){b.fromResponse(c.task),a(b)})},pending:function(){return null===this.status||"pending"==this.status},failed:function(){return"error"==this.status},succeed:function(){return"success"==this.status},raiseIfError:function(){if(this.failed())throw new h.BadTaskStatus(this.error)},nbSubtasks:function(){return this.subtasks_status?this.subtasks_status.total:0},subtasksFailed:function(){return this.subtasks_status?this.subtasks_status.error:[]},subtasksSucceed:function(){return this.subtasks_status?this.subtasks_status.success:[]},subtasksPending:function(){return this.subtasks_status?this.subtasks_status.pending:[]},waitDone:function(a,b,c,d){c=f(c,500),b=f(b,!1),d=f(d,null);var e=0,g=this,h=function(){g.pending()?null!==d&&e>=d?a(!1,g):(setTimeout(function(){g.refresh(h)},c),++e):(b&&g.raiseIfError(),a(!0,g))};this.refresh(h)}},i(a,q),a.prototype.hits=function(a){return(null===this._hits||a)&&(this._hits=k(this.data.hits,!0)),this._hits},i(b,q),b.prototype.hasError=function(){return this.response.has_error},b.prototype.failedRequests=function(){if(!this.hasError())return[];reqs={};var a=this.response.results;for(var b in a){var c=a[b];(c.status_code<200||c.status_code>=300)&&(reqs[b]=c)}return reqs},b.prototype.refresh=function(a){if(!this.id)throw new Error("The batch does not contains any task, no need to refresh/waitDone. Just call objects() to get the results");return q.prototype.refresh.call(this,a)},b.prototype.subtasks=function(a){if(null===this._subtasks||a){this._subtasks={};var b=this.response.results;for(var c in b)task_id=b[c].task_id,task_id&&(this._subtasks[c]=new q(this.client,task_id))}return this._subtasks},b.prototype.objects=function(a){if(null===this._objects||a){this._objects={};var b=this.response.results;for(var c in b){var d=b[c],e=d.object;!e&&d.status_code>=200&&d.status_code<300&&(this._objects[c]=o.fromResponse(e))}}return this._objects},c.prototype={toRequestBody:function(){return this.data}},e.prototype={getDB:function(a){if(a=a?a:this.db,!a)throw new h.DeepomaticSearchError("you must provide a db for the batch request");return a},send:function(a,c){var d=this;this.client._jsonRequest({method:"POST",url:"/search/batch/dbs/",body:d.data
}).then(function(e){var f=new b(d.client,e);if(c&&f.hasError())throw new h.DeepomaticSearchError("One or more requests failed: \n"+JSON.stringify(f.response));a(f)})},getObject:function(a,b){b=this.getDB(b);var d=new c("GET",b,a);return this.data.requests.push(d.toRequestBody()),this},deleteObject:function(a,b){b=this.getDB(b);var d=new c("DELETE",b,a);return this.data.requests.push(d.toRequestBody()),this},addObject:function(a,b){b=this.getDB(b);var d=a.id?"PUT":"POST",e=new c(d,b,a);return this.data.requests.push(e.toRequestBody()),this},toRequestBody:function(){return this.data},clear:function(){this.data={requests:[]}}};var r=function(a,b){this.client=a,this.dbName=b,this.urlDBName=encodeURIComponent(b)};return r.prototype={clear:function(a){var b=this;this.client._jsonRequest({method:"DELETE",url:"/search/dbs/"+b.urlDBName+"/objects/"}).then(function(c){var d=new q(b.client,c.task_id);a(d)})},delete:function(a){var b=this;this.client._jsonRequest({method:"DELETE",url:"/search/dbs/"+b.urlDBName+"/"}).then(function(c){var d=new q(b.client,c.task_id);a(d)})},addObject:function(a,b){var c=this,d=function(d){a.id=d.id;var e=new q(c.client,d.task_id);b(e)};a.id?this.client._jsonRequest({method:"PUT",url:"/search/dbs/"+c.urlDBName+"/objects/"+encodeURIComponent(a.id),body:a.toRequestBody()}).then(d):this.client._jsonRequest({method:"POST",url:"/search/dbs/"+c.urlDBName+"/objects/",body:a.toRequestBody()}).then(d)},deleteObject:function(a,b){var c=this;this.client._jsonRequest({method:"DELETE",url:"/search/dbs/"+c.urlDBName+"/objects/"+encodeURIComponent(a.id)}).then(function(a){var d=new q(c.client,a.task_id);b(d)})},getObject:function(a,b){var c=this;this.client._jsonRequest({method:"GET",url:"/search/dbs/"+c.urlDBName+"/objects/"+encodeURIComponent(a.id)}).then(function(a){b(o.fromResponse(a.object))})},searchWithOpts:function(b,c,e){var f=this,g=b.toRequestBody();d(g,e),this.client._jsonRequest({method:"GET",url:"/search/query/"+f.urlDBName,params:g}).then(function(b){var d=new a(f.client,b.task_id);c(d)})},search:function(b,c,d,e,f,h,i,j){var k=this,l=b.toRequestBody();g(l,"filters",d),g(l,"fields",e),g(l,"limit",f),g(l,"skip",h),g(l,"updated_before",i),g(l,"updated_after",j),this.client._jsonRequest({method:"GET",url:"/search/query/"+k.urlDBName,params:l}).then(function(b){var d=new a(k.client,b.task_id);c(d)})},countWithOpts:function(a,b){var c=this;this.client._jsonRequest({method:"GET",url:"/search/dbs/"+c.urlDBName+"/count/",params:b}).then(function(b){a(b.count)})},count:function(a,b,c,d,e){var f=this,h={};g(h,"filters",b),g(h,"ids",c),g(h,"updated_before",d),g(h,"updated_after",e),this.client._jsonRequest({method:"GET",url:"/search/dbs/"+f.urlDBName+"/count/",params:h}).then(function(b){a(b.count)})},getObjectsWithOpts:function(a,b){var c=this;this.client._jsonRequest({method:"GET",url:"/search/dbs/"+c.urlDBName+"/objects/",params:b}).then(function(b){a(k(b.objects))})},getObjects:function(a,b,c,d,e,f,h,i){var j=this,l={};g(l,"filters",b),g(l,"ids",c),g(l,"fields",d),g(l,"limit",e),g(l,"skip",f),g(l,"updated_before",h),g(l,"updated_after",i),this.client._jsonRequest({method:"GET",url:"/search/dbs/"+j.urlDBName+"/objects/",params:l}).then(function(b){a(k(b.objects))})},batch:function(){return new e(this.client,this.dbName)}},j.prototype={get:function(a){this.client._jsonRequest({method:"GET",url:"/search/dbs/"}).then(function(b){var c=b.dbs,d=[];for(var e in c)d.push(new r(c.client,c[e]));a(d)})}},{BatchObjects:e,Task:q,DBs:j,DB:r,Object:o,Image:n,Bbox:m,Polygon:l}}();b.exports=j},{"./errors":53}],49:[function(a,b,c){(function(c){function d(a,b,c){var d="Usage: deepomaticsearch(applicationID, apiKey, opts)";if(!a)throw new j.DeepomaticSearchError("Please provide an application ID. "+d);if(!b)throw new j.DeepomaticSearchError("Please provide an API Key. "+d);this.apiKey=b,this.applicationID=a,this.hosts={read:[],write:[]},this.hostIndex={read:0,write:0},c=c||{};var g=c.protocol||"https:",h=void 0===c.timeout?1e4:c.timeout;if(/:$/.test(g)||(g+=":"),c.protocol=g,"https:"!==c.protocol)throw new j.DeepomaticSearchError("protocol must be `https:` (was `"+c.protocol+"`)");c.host?(this.hosts.read=[c.host],this.hosts.write=[c.host]):(this.hosts.read=["api.deepomatic.com"],this.hosts.write=["api.deepomatic.com"]),this.hosts.read=e(this.hosts.read,f(g)),this.hosts.write=e(this.hosts.write,f(g)),this.requestTimeout=h,this.extraHeaders=[],this.setExtraHeader("X-APP-ID",this.applicationID),this.setExtraHeader("X-API-KEY",this.apiKey),this.cache={},this._ua=c._ua,this._useCache=void 0===c._useCache||c._useCache,this._setTimeout=c._setTimeout,k("init done, %j",this)}function e(a,b){for(var c=[],d=0;d<a.length;++d)c.push(b(a[d],d));return c}function f(a){return function(b){return a+"//"+b.toLowerCase()}}function g(a,b){b(a,0)}function h(a){if(void 0===Array.prototype.toJSON)return JSON.stringify(a);var b=Array.prototype.toJSON;delete Array.prototype.toJSON;var c=JSON.stringify(a);return Array.prototype.toJSON=b,c}b.exports=d;var i=a("./DB");b.exports.Deepomatic=i;var j=a("./errors"),k=a("debug"),l="v0.6";d.prototype={db:function(a){return new i.DB(this,a)},batch:function(a){return new i.BatchObjects(this,a)},dbs:function(){return new i.DBs(this)},clearCache:function(){this.cache={}},setRequestTimeout:function(a){a&&(this.requestTimeout=parseInt(a,10))},setExtraHeader:function(a,b){this.extraHeaders.push({name:a.toLowerCase(),value:b})},_jsonRequest:function(b){function d(a,g){function o(a){var b=a&&a.body&&a.body.message&&a.body.status||a.statusCode||a&&a.body&&200;f("received response: statusCode: %s, computed statusCode: %d, headers: %j",a.statusCode,b,a.headers),c.env.DEBUG&&c.env.DEBUG.indexOf("debugBody")!==-1&&f("body: %j",a.body);var d=200===b||201===b,e=!d&&4!==Math.floor(b/100)&&1!==Math.floor(b/100);if(k._useCache&&d&&i&&(i[cacheID]=a.body),d)return a.body;if(e)return m+=1,q();var g=new j.DeepomaticSearchError(a.body&&a.body.message);return k._promise.reject(g)}function p(c){return f("error: %s, stack: %s",c.message,c.stack),c instanceof j.DeepomaticSearchError||(c=new j.Unknown(c&&c.message,c)),m+=1,c instanceof j.Unknown||c instanceof j.UnparsableJSON||!a.fallback&&c instanceof j.Network||m>=k.hosts[b.hostType].length&&(n||!b.fallback||!k._request.fallback)?k._promise.reject(c):(k.hostIndex[b.hostType]=++k.hostIndex[b.hostType]%k.hosts[b.hostType].length,c instanceof j.RequestTimeout?q():(k._request.fallback&&!k.useFallback&&(k.useFallback=!0),d(a,g)))}function q(){return k.hostIndex[b.hostType]=++k.hostIndex[b.hostType]%k.hosts[b.hostType].length,g.timeout=k.requestTimeout*(m+1),d(a,g)}if(b.hostType||(b.hostType="write"),m>=k.hosts[b.hostType].length||k.useFallback&&!n)return b.fallback&&k._request.fallback&&!n?(f("switching to fallback"),m=0,g.method=b.fallback.method,g.url=b.fallback.url,g.jsonBody=b.fallback.body,g.jsonBody&&(g.body=h(g.jsonBody)),g.timeout=k.requestTimeout*(m+1),k.hostIndex[b.hostType]=0,n=!0,d(k._request.fallback,g)):(f("could not get any response"),k._promise.reject(new j.DeepomaticSearchError("Cannot connect to the DeepomaticSearch API. Send an email to support@deepomatic.com to report and resolve the issue. Application id was: "+k.applicationID)));var r=k.hosts[b.hostType][k.hostIndex[b.hostType]]+"/"+l+g.url,s={body:e,jsonBody:b.body,params:b.params,method:g.method,headers:k._computeRequestHeaders(),timeout:g.timeout,debug:f};return f("method: %s, url: %s, headers: %j, timeout: %d",s.method,r,s.headers,s.timeout),a===k._request.fallback&&f("using fallback"),a.call(k,r,s).then(o,p)}var e,f=a("debug")("deepomaticsearch:"+b.url),i=b.cache,k=this,m=0,n=!1;void 0!==b.body&&(e=h(b.body)),f("request start");var o=k.useFallback&&b.fallback,p=o?b.fallback:b,q=d(o?k._request.fallback:k._request,{url:p.url,method:p.method,body:e,jsonBody:b.body,timeout:k.requestTimeout*(m+1)});return b.callback?void q.then(function(a){g(function(){b.callback(null,a)},k._setTimeout||setTimeout)},function(a){g(function(){b.callback(a)},k._setTimeout||setTimeout)}):q},_getSearchParams:function(a,b){if(this._isUndefined(a)||null===a)return b;for(var c in a)null!==c&&void 0!==a[c]&&a.hasOwnProperty(c)&&(b+=""===b?"":"&",b+=c+"="+encodeURIComponent("[object Array]"===Object.prototype.toString.call(a[c])?h(a[c]):a[c]));return b},_isUndefined:function(a){return void 0===a},_computeRequestHeaders:function(){var b=a("lodash-compat/collection/forEach"),c={};return this.extraHeaders&&b(this.extraHeaders,function(a){c[a.name]=a.value}),c}}}).call(this,a("_process"))},{"./DB":48,"./errors":53,_process:5,debug:1,"lodash-compat/collection/forEach":10}],50:[function(a,b,c){"use strict";function d(b,c,f){var g=a("lodash-compat/lang/cloneDeep");return f=g(f||{}),void 0===f.protocol&&(f.protocol="https:"),f._ua=f._ua||d.ua,new e(b,c,f)}function e(){i.apply(this,arguments)}function f(a){if(!a)return"";var b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]));return"?"+b.join("&")}var g=a("inherits"),h=window.Promise||a("es6-promise").Promise,i=a("../../DeepomaticSearch"),j=a("../../errors"),k=a("../inline-headers"),l=a("../jsonp-request"),m=i.Deepomatic;m.Client=d,b.exports=m,d.ua="Deepomatic for vanilla JavaScript ",window.Deepomatic=m,window.Deepomatic.debug=a("debug");var n={hasXMLHttpRequest:"XMLHttpRequest"in window,hasXDomainRequest:"XDomainRequest"in window,cors:"withCredentials"in new XMLHttpRequest,timeout:"timeout"in new XMLHttpRequest};g(e,i),e.prototype._request=function(a,b){return new h(function(c,d){function e(){if(!k){n.timeout||clearTimeout(i);var a;try{a={body:JSON.parse(m.responseText),statusCode:m.status,headers:m.getAllResponseHeaders&&m.getAllResponseHeaders()||{}}}catch(b){a=new j.UnparsableJSON({more:m.responseText})}a instanceof j.UnparsableJSON?d(a):c(a)}}function g(a){k||(n.timeout||clearTimeout(i),d(new j.Network({more:a})))}function h(){n.timeout||(k=!0,m.abort()),d(new j.RequestTimeout)}if(!n.cors)return void d(new j.Network("CORS not supported"));b.params&&(a+=f(b.params));var i,k,l=b.body,m=n.cors?new XMLHttpRequest:new XDomainRequest;m instanceof XMLHttpRequest?m.open(b.method,a,!0):m.open(b.method,a),m.setRequestHeader("content-type","application/json"),m.setRequestHeader("accept","application/json");for(var o in b.headers)m.setRequestHeader(o,b.headers[o]);m.onprogress=function(){},m.onload=e,m.onerror=g,n.timeout?(m.timeout=b.timeout,m.ontimeout=h):i=setTimeout(h,b.timeout),m.send(l)})},e.prototype._request.fallback=function(a,b){return a=k(a,b.headers),new h(function(c,d){l(a,b,function(a,b){return a?void d(a):void c(b)})})},e.prototype._promise={reject:function(a){return h.reject(a)},resolve:function(a){return h.resolve(a)},delay:function(a){return new h(function(b){setTimeout(b,a)})}}},{"../../DeepomaticSearch":49,"../../errors":53,"../inline-headers":51,"../jsonp-request":52,debug:1,"es6-promise":4,inherits:9,"lodash-compat/lang/cloneDeep":37}],51:[function(a,b,c){"use strict";function d(a,b){return a+=/\?/.test(a)?"&":"?",a+e.encode(b)}b.exports=d;var e=a("querystring")},{querystring:8}],52:[function(a,b,c){"use strict";function d(a,b,c){function d(){b.debug("JSONP: success"),p||l||(p=!0,k||(b.debug("JSONP: Fail. Script loaded but did not call the callback"),h(),c(new e.JSONPScriptFail)))}function g(){"loaded"!==this.readyState&&"complete"!==this.readyState||d()}function h(){clearTimeout(q),n.onload=null,n.onreadystatechange=null,n.onerror=null,m.removeChild(n);try{delete window[o],delete window[o+"_loaded"]}catch(a){window[o]=null,window[o+"_loaded"]=null}}function i(){b.debug("JSONP: Script timeout"),l=!0,h(),c(new e.RequestTimeout)}function j(){b.debug("JSONP: Script error"),p||l||(h(),c(new e.JSONPScriptError))}if("GET"!==b.method)return void c(new Error("Method "+b.method+" "+a+" is not supported by JSONP."));b.debug("JSONP: start");var k=!1,l=!1;f+=1;var m=document.getElementsByTagName("head")[0],n=document.createElement("script"),o="deepomaticJSONP_"+f,p=!1;window[o]=function(a){try{delete window[o]}catch(a){window[o]=void 0}l||(k=!0,h(),c(null,{body:a}))},a+="&callback="+o,b.jsonBody&&b.jsonBody.params&&(a+="&"+b.jsonBody.params);var q=setTimeout(i,b.timeout);n.onreadystatechange=g,n.onload=d,n.onerror=j,n.async=!0,n.defer=!0,n.src=a,m.appendChild(n)}b.exports=d;var e=a("../errors"),f=0},{"../errors":53}],53:[function(a,b,c){function d(b,c){var d=a("lodash-compat/collection/forEach"),e=this;"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):e.stack=(new Error).stack||"Cannot get a stacktrace, browser is too old",this.name=this.constructor.name,this.message=b||"Unknown error",c&&d(c,function(a,b){e[b]=a})}function e(a,b){function c(){var c=Array.prototype.slice.call(arguments,0);"string"!=typeof c[0]&&c.unshift(b),d.apply(this,c),this.name="DeepomaticSearch"+a+"Error"}return f(c,d),c}var f=a("inherits");f(d,Error),b.exports={DeepomaticSearchError:d,UnparsableJSON:e("UnparsableJSON","Could not parse the incoming response as JSON, see err.more for details"),RequestTimeout:e("RequestTimeout","Request timedout before getting a response"),Network:e("Network","Network issue, see err.more for details"),JSONPScriptFail:e("JSONPScriptFail","<script> was loaded but did not call our provided callback"),JSONPScriptError:e("JSONPScriptError","<script> unable to load due to an `error` event on it"),Unknown:e("Unknown","Unknown error occured"),BadTaskStatus:e("BadTaskStatus","Task got a bad status, check the error field")}},{inherits:9,"lodash-compat/collection/forEach":10}]},{},[50])(50)});